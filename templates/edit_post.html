{% extends "base.html" %}

{% block styles %}
    <link rel="stylesheet" href="/static/styles/addpost.css">
{% endblock %}

{% block title %}Edit Post - My Blog{% endblock %}

{% block content %}
    <form action="{{ url_for('edit_post', id=post.id) }}" method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.title.label }}<br>
            {{ form.title(size=32) }}
        </div>
        <div class="form-group">
            {{ form.content.label }}<br>
            {{ form.content(rows=10) }}
        </div>
        <div class="form-group">
            {{ form.image.label }}<br>
            <!-- Display the current image if available -->
            {% if post.image_file %}
                <img src="{{ url_for('static', filename='uploads/' ~ post.image_file) }}" alt="Current Image" style="max-width: 100%; height: auto;">
                <br>
            {% endif %}

            <div class="form-group">
                {{ form.image.label }}<br>
                {{ form.image() }}
            </div>
            <div id="imagePreview" class="image-preview"></div>
        </div>
        {{ form.submit(class="submit") }}
    </form>

    <script>
        document.getElementById('imageInput').addEventListener('change', function(event) {
            var output = document.getElementById('imagePreview');
            output.innerHTML = ''; // Clear previous preview
            if (event.target.files && event.target.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var img = document.createElement('img');
                    output.style.display = 'block'; // Make the preview visible
                    img.src = e.target.result;
                    img.style.maxWidth = '100%';
                    img.style.height = 'auto';
                    output.appendChild(img);
                };
                reader.readAsDataURL(event.target.files[0]);
            }
        });
    </script>
{% endblock %}
